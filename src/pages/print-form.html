<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; font-src 'self'; img-src 'self' data:; connect-src 'self';">
    <title>Print Form - Noor & Sons Tailors</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/print-form.css">
    <style>
        /* Print-specific styles for the standalone print form */
        body {
            margin: 0;
            padding: 5mm;
            font-size: 12px;
            line-height: 1.3;
            width: 210mm;
            background: white;
            color: #000;
        }

        .container {
            max-width: none;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* Custom print layout for Noor & Sons tailor form */
        .print-form {
            display: block !important;
        }

        /* Header styles */
        .print-header {
            display: flex !important;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px 0 15px 0;
            border-bottom: 2px solid #000;
            margin-bottom: 15px;
        }

        .logo-left {
            height: 80px;
            width: auto;
            flex-shrink: 0;
        }

        .logo-right-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }

        .logo-right {
            height: 70px;
            width: auto;
        }

        .logo-right-bottom {
            height: 30px;
            width: auto;
        }

        .shop-info {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }

        .shop-info h2 {
            margin: 0;
            font-size: 22px;
            font-weight: bold;
            color: #000;
            letter-spacing: 1px;
        }

        .shop-info p {
            margin: 8px 0 0;
            font-size: 16px;
            font-style: italic;
            color: #333;
        }

        /* Customer info section */
        .customer-info {
            margin-top: 10px;
        }

        .info-row {
            display: flex;
            margin-bottom: 10px;
            align-items: flex-end;
        }

        .info-item {
            display: flex;
            align-items: baseline;
            margin-right: 30px;
        }

        .info-item.grid-span-3 {
            flex: 1;
            margin-right: 0;
        }

        .info-label {
            font-size: 11px;
            font-weight: normal;
            margin: 0;
            margin-right: 8px;
            white-space: nowrap;
        }

        .info-value {
            border-bottom: 1px solid #999;
            min-height: 18px;
            padding: 2px 0;
            min-width: 80px;
            width: fit-content;
            max-width: 120px;
        }

        /* Cutting section */
        .cutting-section {
            margin-top: 10px;
            display: flex;
            background-color: #f0f0f0;
            padding: 5px 15px;
            align-items: center;
            width: 100%;
            justify-content: space-evenly;
        }

        .cutting-item {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .cutting-item label {
            margin-right: 8px;
            font-size: 11px;
            white-space: nowrap;
        }

        .cutting-value {
            border-bottom: 1px solid #999;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            min-height: 18px;
            padding: 2px 5px;
        }

        .garment-type {
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            flex: 1;
            text-align: right;
        }

        /* Measurement sections */
        .measurement-section {
            margin-top: 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }

        /* Qameez two-column layout */
        .qameez-two-column-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-column-gap: 40px;
            grid-row-gap: 8px;
        }

        .qameez-column-1,
        .qameez-column-2 {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .qameez-measure-item {
            display: flex;
            align-items: baseline;
            gap: 8px;
            font-size: 11px;
            line-height: 1.4;
        }

        .qameez-label {
            font-weight: normal;
            white-space: nowrap;
            min-width: 60px;
        }

        .qameez-value {
            border-bottom: none;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            min-height: 16px;
            padding: 1px 2px;
        }

        .qameez-style {
            font-size: 10px;
            color: #666;
            white-space: nowrap;
            margin-left: 4px;
        }

        /* Shalwar two-column layout */
        .shalwar-two-column-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-column-gap: 40px;
            grid-row-gap: 8px;
        }

        .shalwar-column-1,
        .shalwar-column-2 {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .shalwar-measure-item {
            display: flex;
            align-items: baseline;
            gap: 8px;
            font-size: 11px;
            line-height: 1.4;
        }

        .shalwar-label {
            font-weight: normal;
            white-space: nowrap;
            min-width: 60px;
        }

        .shalwar-value {
            border-bottom: none;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            min-height: 16px;
            padding: 1px 2px;
        }

        /* Regular measurements grid for Shalwar */
        .measurements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-column-gap: 30px;
            grid-row-gap: 10px;
        }

        .measure-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .measure-label {
            margin-right: 10px;
        }

        .measure-value {
            border-bottom: none;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            text-align: center;
        }

        /* Separator line */
        .separator {
            height: 1px;
            background-color: #000;
            margin: 15px 0;
        }

        /* Extra demand section */
        .extra-demand {
            margin-top: 15px;
        }

        .extra-demand-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .extra-demand-value {
            border-bottom: 1px solid #999;
            padding: 5px 0;
            min-height: 20px;
            width: fit-content;
            max-width: 300px;
            min-width: 100px;
        }

        /* Hide empty fields in print */
        .print-field.empty {
            display: none !important;
        }

        .hidden {
            display: none !important;
        }

        /* No print styles for standalone print form */
        .no-print {
            display: none !important;
        }

        /* Print button styling */
        .print-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .print-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .print-btn:hover {
            background: #0056b3;
        }

        /* Auto print when page loads */
        @media print {
            body {
                margin: 0;
                padding: 0;
            }

            .print-controls {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <!-- Print Controls -->
    <div class="print-controls no-print">
        <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print</button>
    </div> <!-- Print Form Layout -->
    <div class="print-form">
        <!-- Print Header with Logos -->
        <div class="print-header">
            <img src="../assets/img/logo-pic.png" alt="Noor & Sons Logo" class="logo-left">
            <div class="shop-info">
                <h2>Noor & Sons Tailors And Fabrics</h2>
                <p>We offer you stitching of your choice</p>
            </div>
            <div class="logo-right-container">
                <img src="../assets/img/coat_logo-pic.png" alt="Coat Logo" class="logo-right">
                <img src="../assets/img/Needle-logo.jpg" alt="Needle Logo" class="logo-right-bottom">
            </div>
        </div>

        <!-- Customer Info Section -->
        <div class="customer-info">
            <div class="info-row">
                <div class="info-item">
                    <label class="info-label">Code Number</label>
                    <div class="info-value" id="print-code-number"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Order Date</label>
                    <div class="info-value" id="print-order-date"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Return Date</label>
                    <div class="info-value" id="print-return-date"></div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-item">
                    <label class="info-label">Name</label>
                    <div class="info-value" id="print-name"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Age</label>
                    <div class="info-value" id="print-age"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Cell Number</label>
                    <div class="info-value" id="print-cell-number"></div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-item grid-span-3">
                    <label class="info-label">Address</label>
                    <div class="info-value" id="print-address"></div>
                </div>
            </div>
        </div> <!-- Cutting Section -->
        <div class="cutting-section">
            <div class="cutting-item">
                <label>Cutting No:</label>
                <div class="cutting-value" id="print-cutting-no"></div>
            </div>
            <div class="cutting-item">
                <label>Quantity:</label>
                <div class="cutting-value" id="print-quantity"></div>
            </div>
            <div class="cutting-item">
                <label>Enter by <span id="print-entered-by">Abubakkar</span></label>
            </div>
            <div class="garment-type">ÿ¥ŸÑŸàÿßÿ± ŸÇŸÖ€åÿµ</div>
        </div> <!-- Qameez Section -->
        <div class="measurement-section" id="print-qameez-section">
            <div class="qameez-two-column-grid">
                <!-- Column 1 -->
                <div class="qameez-column-1">
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ŸÑŸÖÿ®ÿßÿ¶€å</span>
                        <span class="qameez-value" id="qameez-lambai"></span>
                        <span class="qameez-style" id="qameez-daman-style"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ÿ¢ÿ≥ÿ™€åŸÜ</span>
                        <span class="qameez-value" id="qameez-asteen"></span>
                        <span class="qameez-style" id="qameez-sleeve-style"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ÿ™€åÿ±ÿß</span>
                        <span class="qameez-value" id="qameez-tera"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label" id="qameez-collar-type-label">ÿ®€åŸÜ / ⁄©ÿßŸÑÿ±</span>
                        <span class="qameez-value" id="qameez-collar-measurement"></span>
                        <span class="qameez-style" id="qameez-collar-style"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">⁄Ü⁄æÿßÿ™€å</span>
                        <span class="qameez-value" id="qameez-chati"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">⁄©ŸÖÿ±</span>
                        <span class="qameez-value" id="qameez-kamar"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">⁄Ø€åÿ±€Å</span>
                        <span class="qameez-value" id="qameez-gira"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ŸÖŸà⁄ë€Å</span>
                        <span class="qameez-value" id="qameez-moza"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ÿ¥ŸàŸÑ⁄àÿ±</span>
                        <span class="qameez-value" id="qameez-shoulder"></span>
                    </div>
                </div>

                <!-- Column 2 -->
                <div class="qameez-column-2">
                    <div class="qameez-measure-item">
                        <span class="qameez-label">Ÿæÿß⁄©Ÿπ</span>
                        <span class="qameez-value" id="qameez-pocket-type"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ŸÅÿ±ŸÜŸπ Ÿæÿß⁄©Ÿπ</span>
                        <span class="qameez-style" id="qameez-front-pocket-style"></span>
                        <span class="qameez-value" id="qameez-front-pocket-size"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ÿ≥ŸÑÿßÿ¶€å</span>
                        <span class="qameez-value" id="qameez-silai"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ÿ±ŸÜ⁄Ø ÿ®ŸπŸÜ</span>
                        <span class="qameez-style" id="qameez-button-color"></span>
                        <span class="qameez-value" id="qameez-button-size"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label" id="qameez-cuff-plate-label">ŸæŸÑ€åŸπ ŸàÿßŸÑÿß ⁄©ŸÅ</span>
                        <span class="qameez-style" id="qameez-cuff-style"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">⁄©ŸÅ ⁄©ÿßÿ¨</span>
                        <span class="qameez-value" id="qameez-cuff-kaj"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">⁄Ü⁄© ŸæŸπ€å</span>
                        <span class="qameez-value" id="qameez-chak-patti"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">⁄Ü⁄© ŸæŸπ€å ⁄©ÿßÿ¨</span>
                        <span class="qameez-value" id="qameez-chak-patti-kaj"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ŸæŸπ€å</span>
                        <span class="qameez-value" id="qameez-patti"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">ŸæŸπ€å ⁄ÜŸà⁄ëÿßÿ¶€å</span>
                        <span class="qameez-value" id="qameez-patti-churai"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Separator Line -->
        <div class="separator"></div> <!-- Shalwar Section -->
        <div class="measurement-section" id="print-shalwar-section">
            <div class="shalwar-two-column-grid">
                <!-- Column 1 -->
                <div class="shalwar-column-1">
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">ÿ¥ŸÑŸàÿßÿ± ŸÑŸÖÿ®ÿßÿ¶€å</span>
                        <span class="shalwar-value" id="shalwar-lambai"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">ŸæÿßŸÜ⁄Ü€Å</span>
                        <span class="shalwar-value" id="shalwar-pacha"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">€ÅŸæ</span>
                        <span class="shalwar-value" id="shalwar-hip"></span>
                    </div>
                </div>

                <!-- Column 2 -->
                <div class="shalwar-column-2">
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">ÿßŸÜÿ≥ÿß€å⁄à</span>
                        <span class="shalwar-value" id="shalwar-ander"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">ÿ¥ŸÑŸàÿßÿ± Ÿæÿß⁄©Ÿπ</span>
                        <span class="shalwar-value" id="shalwar-pocket"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">ÿ¥ŸÑŸàÿßÿ± ŸÇÿ≥ŸÖ</span>
                        <span class="shalwar-value" id="shalwar-type"></span>
                    </div>
                </div>
            </div>
        </div><!-- Extra Demand Section -->
        <div class="extra-demand" id="print-extra-demand-section">
            <div class="extra-demand-label">ÿß€å⁄©ÿ≥Ÿπÿ±ÿß ⁄à€åŸÖÿßŸÜ⁄à</div>
            <div class="extra-demand-value" id="print-extra-demand"></div>
        </div>
    </div>

    <!-- Print Controls (hidden during printing) -->
    <div class="print-controls" id="print-controls">
        <button onclick="manualPrint()" class="btn-print">üñ®Ô∏è Print Again</button>
        <button onclick="window.close()" class="btn-close">‚úñ Close</button>
    </div>
    <script>
        // Print form functionality with comprehensive error handling
        function loadCustomerDataFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const customerId = urlParams.get('id');

                if (customerId) {
                    const customers = JSON.parse(localStorage.getItem('customers') || '[]');
                    const customer = customers.find(c => (c.id || c._id) === customerId);

                    if (customer) {
                        populatePrintForm(customer);
                        // Auto print after a delay to ensure everything loads
                        setTimeout(() => {
                            window.print();
                        }, 1000);
                    } else {
                        console.error('Customer not found with ID:', customerId);
                        alert('Customer data not found. Please check the customer ID.');
                    }
                } else {
                    console.error('No customer ID provided in URL');
                    alert('No customer ID provided in URL.');
                }
            } catch (error) {
                console.error('Error loading customer data:', error);
                alert('Error loading customer data: ' + error.message);
            }
        }

        function populatePrintForm(customer) {
            try {
                // Helper function to format date
                const formatPrintDate = (dateStr) => {
                    if (!dateStr) return '';
                    try {
                        const date = new Date(dateStr);
                        return date.toLocaleDateString();
                    } catch (e) {
                        return dateStr;
                    }
                };

                // Helper function to check if a field has a value
                const hasValue = (value) => {
                    return value && value.toString().trim() !== '';
                };

                // Helper function to safely set text content
                const safeSetTextContent = (id, value) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value || '';
                    } else {
                        console.warn(`Element with ID '${id}' not found in print form`);
                    }
                };

                // Populate customer info with error handling
                safeSetTextContent('print-code-number', customer.codeNumber);
                safeSetTextContent('print-order-date', formatPrintDate(customer.orderDate));
                safeSetTextContent('print-return-date', formatPrintDate(customer.returnDate));
                safeSetTextContent('print-name', customer.name);
                safeSetTextContent('print-age', customer.age);
                safeSetTextContent('print-cell-number', customer.cellNumber);
                safeSetTextContent('print-address', customer.address);
                safeSetTextContent('print-cutting-no', customer.cuttingNo);
                safeSetTextContent('print-quantity', customer.quantity);
                safeSetTextContent('print-entered-by', customer.enteredBy || 'Abubakkar');

                // Define measurements including collar_measurement
                const qameezMeasurements = [
                    { field: 'lambai', label: 'ŸÑŸÖÿ®ÿßÿ¶€å' },
                    { field: 'asteen', label: 'ÿ¢ÿ≥ÿ™€åŸÜ' },
                    { field: 'tera', label: 'ÿ™€åÿ±ÿß' },
                    { field: 'collar_measurement', label: 'ÿ®€åŸÜ / ⁄©ÿßŸÑÿ± ŸÖÿßŸæ' },
                    { field: 'chati', label: '⁄Ü⁄æÿßÿ™€å' },
                    { field: 'kamar', label: '⁄©ŸÖÿ±' },
                    { field: 'gira', label: '⁄Ø€åÿ±€Å' },
                    { field: 'moza', label: 'ŸÖŸà⁄ë€Å' },
                    { field: 'gol_asteen', label: '⁄ØŸàŸÑ ÿ¢ÿ≥ÿ™€åŸÜ' },
                    { field: 'collar_type', label: '⁄©ÿßŸÑÿ± Ÿπÿßÿ¶Ÿæ' },
                    { field: 'collar_style', label: '⁄©ÿßŸÑÿ± ÿßÿ≥Ÿπÿßÿ¶ŸÑ' },
                    { field: 'front_pocket_size', label: 'ŸÅÿ±ŸÜŸπ Ÿæÿß⁄©Ÿπ ÿ≥ÿßÿ¶ÿ≤' },
                    { field: 'double_side_pocket', label: '⁄àÿ®ŸÑ ÿ≥ÿßÿ¶€å⁄à Ÿæÿß⁄©Ÿπ' },
                    { field: 'single_pocket', label: 'ÿ≥ŸÜ⁄ØŸÑ Ÿæÿß⁄©Ÿπ' },
                    { field: 'front_pocket', label: 'ŸÅÿ±ŸÜŸπ Ÿæÿß⁄©Ÿπ' },
                    { field: 'silai', label: 'ÿ≥ŸÑÿßÿ¶€å' },
                    { field: 'button_color', label: 'ÿ®ŸπŸÜ ⁄©ÿß ÿ±ŸÜ⁄Ø' },
                    { field: 'button', label: 'ÿ®ŸπŸÜ' },
                    { field: 'button_size', label: 'ÿ®ŸπŸÜ ÿ≥ÿßÿ¶ÿ≤' },
                    { field: 'cuff_plate', label: '⁄©ŸÅ ŸæŸÑ€åŸπ' },
                    { field: 'cuff_style', label: '⁄©ŸÅ ÿßÿ≥Ÿπÿßÿ¶ŸÑ' },
                    { field: 'cuff_kaj', label: '⁄©ŸÅ ⁄©ÿßÿ¨' }, { field: 'chak_patti', label: '⁄Ü⁄© ŸæŸπ€å' },
                    { field: 'chak_patti_kaj', label: '⁄Ü⁄© ŸæŸπ€å ⁄©ÿßÿ¨' },
                    { field: 'daman', label: 'ÿØÿßŸÖŸÜ' },
                    { field: 'shoulder', label: 'ÿ¥ŸàŸÑ⁄àÿ±' },
                    { field: 'shoulder_style', label: 'ÿ¥ŸàŸÑ⁄àÿ± ÿßÿ≥Ÿπÿßÿ¶ŸÑ' },
                    { field: 'sleeve_type', label: 'ÿ¢ÿ≥ÿ™€åŸÜ ⁄©€å ŸÇÿ≥ŸÖ' },
                    { field: 'patti', label: 'ŸæŸπ€å' },
                    { field: 'patti_churai', label: 'ŸæŸπ€å ⁄ÜŸà⁄ëÿßÿ¶€å' }
                ];

                const shalwarMeasurements = [{ field: 'shalwar_lambai', label: 'ÿ¥ŸÑŸàÿßÿ± ŸÑŸÖÿ®ÿßÿ¶€å' },
                { field: 'pacha', label: 'ŸæÿßŸÜ⁄Ü€Å' },
                { field: 'lib', label: '€ÅŸæ' },
                { field: 'ander', label: 'ÿßŸÜÿ≥ÿß€å⁄à' },
                { field: 'shalwar_pocket', label: 'ÿ¥ŸÑŸàÿßÿ± Ÿæÿß⁄©Ÿπ' },
                { field: 'shalwar_type', label: 'ÿ¥ŸÑŸàÿßÿ± ŸÇÿ≥ŸÖ' }
                ];

                // Populate measurements
                const measurements = customer.measurements || {};

                // Populate individual qameez fields in the two-column layout with error handling
                safeSetTextContent('qameez-lambai', measurements.lambai);
                safeSetTextContent('qameez-asteen', measurements.asteen);
                safeSetTextContent('qameez-tera', measurements.tera);
                safeSetTextContent('qameez-collar-measurement', measurements.collar_measurement);
                safeSetTextContent('qameez-chati', measurements.chati);
                safeSetTextContent('qameez-kamar', measurements.kamar);
                safeSetTextContent('qameez-gira', measurements.gira);
                safeSetTextContent('qameez-moza', measurements.moza);
                safeSetTextContent('qameez-shoulder', measurements.shoulder);

                // Populate style fields with error handling
                safeSetTextContent('qameez-daman-style', measurements.daman);
                safeSetTextContent('qameez-sleeve-style', measurements.sleeve_type);
                safeSetTextContent('qameez-collar-style', measurements.collar_style);
                safeSetTextContent('qameez-pocket-type', measurements.single_pocket || measurements.double_side_pocket);
                safeSetTextContent('qameez-front-pocket-style', measurements.front_pocket);
                safeSetTextContent('qameez-front-pocket-size', measurements.front_pocket_size);
                safeSetTextContent('qameez-silai', measurements.silai);
                safeSetTextContent('qameez-button-color', measurements.button_color);
                safeSetTextContent('qameez-button-size', measurements.button_size);
                safeSetTextContent('qameez-cuff-style', measurements.cuff_style); safeSetTextContent('qameez-cuff-kaj', measurements.cuff_kaj); safeSetTextContent('qameez-chak-patti', measurements.chak_patti);
                safeSetTextContent('qameez-chak-patti-kaj', measurements.chak_patti_kaj);
                safeSetTextContent('qameez-patti', measurements.patti);
                safeSetTextContent('qameez-patti-churai', measurements.patti_churai);

                // Populate individual shalwar fields in the two-column layout with error handling
                safeSetTextContent('shalwar-lambai', measurements.shalwar_lambai);
                safeSetTextContent('shalwar-pacha', measurements.pacha);
                safeSetTextContent('shalwar-hip', measurements.lib);
                safeSetTextContent('shalwar-ander', measurements.ander);
                safeSetTextContent('shalwar-pocket', measurements.shalwar_pocket);
                safeSetTextContent('shalwar-type', measurements.shalwar_type);

                // Generate Qameez measurements HTML (for dynamic container if needed)
                // Note: We're now using static two-column layout, so this container might not exist
                const qameezContainer = document.getElementById('print-qameez-measurements');
                if (qameezContainer) {
                    qameezContainer.innerHTML = '';

                    qameezMeasurements.forEach(item => {
                        if (hasValue(measurements[item.field])) {
                            const measureItem = document.createElement('div');
                            measureItem.className = 'measure-item';
                            measureItem.innerHTML = `
                                <div class="measure-label">${item.label}</div>
                                <div class="measure-value">${measurements[item.field]}</div>
                            `;
                            qameezContainer.appendChild(measureItem);
                        }
                    });
                }

                // Hide sections if no measurements (with error handling)
                const qameezSection = document.getElementById('print-qameez-section');
                // Check if qameez has any data by looking at the main fields
                const hasQameezData = measurements.lambai || measurements.asteen || measurements.chati || measurements.collar_measurement;
                if (qameezSection) {
                    if (!hasQameezData && (!qameezContainer || qameezContainer.children.length === 0)) {
                        qameezSection.classList.add('hidden');
                    } else {
                        qameezSection.classList.remove('hidden');
                    }
                } const shalwarSection = document.getElementById('print-shalwar-section');
                // Check if shalwar has any data by looking at the main fields
                const hasShalwarData = measurements.shalwar_lambai || measurements.pacha || measurements.lib;
                if (shalwarSection) {
                    if (!hasShalwarData) {
                        shalwarSection.classList.add('hidden');
                    } else {
                        shalwarSection.classList.remove('hidden');
                    }
                }

                // Handle extra demand with error handling
                const extraDemandValue = measurements.extra_demand || '';
                safeSetTextContent('print-extra-demand', extraDemandValue);
                const extraDemandSection = document.getElementById('print-extra-demand-section');
                if (extraDemandSection) {
                    if (extraDemandValue) {
                        extraDemandSection.classList.remove('hidden');
                    } else {
                        extraDemandSection.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error populating print form:', error);
                alert('Error loading print data: ' + error.message);
            }
        }

        // Manual print function for backup
        function manualPrint() {
            try {
                window.print();
            } catch (error) {
                console.error('Print error:', error);
                alert('Print failed: ' + error.message);
            }
        }

        // Load customer data when page loads
        window.addEventListener('load', loadCustomerDataFromURL);
    </script>
</body>

</html>