<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; font-src 'self'; img-src 'self' data:; connect-src 'self';">
    <title>Print Form - Noor & Sons Tailors</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/print-form.css">
    <style>
        /* Print-specific styles for the standalone print form */
        body {
            margin: 0;
            padding: 5mm;
            font-size: 12px;
            line-height: 1.3;
            width: 210mm;
            background: white;
            color: #000;
        }

        .container {
            max-width: none;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* Custom print layout for Noor & Sons tailor form */
        .print-form {
            display: block !important;
        }

        /* Header styles */
        .print-header {
            display: flex !important;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px 0 15px 0;
            border-bottom: 2px solid #000;
            margin-bottom: 15px;
        }

        .logo-left {
            height: 80px;
            width: auto;
            flex-shrink: 0;
        }

        .logo-right-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }

        .logo-right {
            height: 70px;
            width: auto;
        }

        .logo-right-bottom {
            height: 30px;
            width: auto;
        }

        .shop-info {
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }

        .shop-info h2 {
            margin: 0;
            font-size: 22px;
            font-weight: bold;
            color: #000;
            letter-spacing: 1px;
        }

        .shop-info p {
            margin: 8px 0 0;
            font-size: 16px;
            font-style: italic;
            color: #333;
        }

        /* Customer info section */
        .customer-info {
            margin-top: 10px;
        }

        .info-row {
            display: flex;
            margin-bottom: 10px;
            align-items: flex-end;
        }

        .info-item {
            display: flex;
            align-items: baseline;
            margin-right: 30px;
        }

        .info-item.grid-span-3 {
            flex: 1;
            margin-right: 0;
        }

        .info-label {
            font-size: 11px;
            font-weight: normal;
            margin: 0;
            margin-right: 8px;
            white-space: nowrap;
        }

        .info-value {
            border-bottom: 1px solid #999;
            min-height: 18px;
            padding: 2px 0;
            min-width: 80px;
            width: fit-content;
            max-width: 120px;
        }

        /* Cutting section */
        .cutting-section {
            margin-top: 10px;
            display: flex;
            background-color: #f0f0f0;
            padding: 5px 15px;
            align-items: center;
            width: 100%;
            justify-content: space-evenly;
        }

        .cutting-item {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .cutting-item label {
            margin-right: 8px;
            font-size: 11px;
            white-space: nowrap;
        }

        .cutting-value {
            border-bottom: 1px solid #999;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            min-height: 18px;
            padding: 2px 5px;
        }

        .garment-type {
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            flex: 1;
            text-align: right;
        }

        /* Measurement sections */
        .measurement-section {
            margin-top: 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }

        /* Qameez two-column layout */
        .qameez-two-column-grid {
            display: flex;
            align-items: flex-start;
            margin: 0;
            padding: 0;
            width: 100%;
            position: relative;
            min-height: 300px;
            /* Ensure container has enough height */
        }

        .qameez-column-1,
        .qameez-column-2 {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .qameez-column-1 {
            /* Left column stays in normal position */
            width: 80mm;
            margin-left: 0;
        }

        .qameez-column-2 {
            /* Right column positioned to the absolute rightmost edge */
            width: 80mm;
            position: absolute;
            right: 0;
            top: 0;
        }

        .qameez-measure-item {
            display: flex;
            align-items: baseline;
            gap: 8px;
            font-size: 11px;
            line-height: 1.4;
        }        .qameez-label {
            font-weight: bold;
            white-space: nowrap;
            min-width: 60px;
        }        .qameez-value {
            border-bottom: none;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            min-height: 16px;
            padding: 1px 2px;
            font-weight: bold;
            color: #000;
        }        .qameez-style {
            font-size: 12px;
            color: #000;
            white-space: nowrap;
            margin-left: 4px;
            font-weight: bold;
        }

        .qameez-collar-combined {
            font-weight: bold;
        }

        /* Compact styling for collar/ben field */
        .qameez-value.compact,
        .qameez-style.compact {
            margin-left: 8px;
            margin-right: 5px;
            min-width: 25px;
            max-width: 50px;
            font-size: 11px;
            border-bottom: 1px solid #999;
            padding: 1px 2px;
            display: inline-block;
        }

        .qameez-style.compact {
            border-bottom: none;
            color: #000;
            font-weight: normal;
        }

        /* Prevent text wrapping in second column */
        .qameez-column-2 .qameez-style {
            white-space: nowrap;
        }

        .qameez-column-2 .qameez-value {
            white-space: nowrap;
        }

        .qameez-column-2 .qameez-collar-combined {
            white-space: nowrap;
        }

        /* Grouped options section below qameez columns */
        .qameez-grouped-options {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 15px 25px;
            border: 2px solid #000;
            border-radius: 50%;
            width: 120px;
            height: 80px;
            margin-left: auto;
            margin-right: auto;
            background-color: transparent;
        }

        .grouped-option-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 10px;
            width: 100%;
            justify-content: space-between;
        }

        .option-label {
            font-weight: normal;
            white-space: nowrap;
            font-size: 9px;
        }        .option-value {
            border-bottom: 1px solid #999;
            min-width: 30px;
            min-height: 12px;
            padding: 1px 2px;
            font-size: 9px;
            flex-shrink: 0;
            color: #000;
        }

        /* Shalwar two-column layout */
        .shalwar-two-column-grid {
            display: flex;
            align-items: flex-start;
            margin: 0;
            padding: 0;
            width: 100%;
            position: relative;
        }

        .shalwar-column-1,
        .shalwar-column-2 {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .shalwar-column-1 {
            /* Left column stays in normal position */
            width: 80mm;
            margin-left: 0;
        }

        .shalwar-column-2 {
            /* Right column positioned to the absolute rightmost edge */
            width: 80mm;
            position: absolute;
            right: 0;
            top: 0;
        }

        .shalwar-measure-item {
            display: flex;
            align-items: baseline;
            gap: 8px;
            font-size: 11px;
            line-height: 1.4;
        }        .shalwar-label {
            font-weight: bold;
            white-space: nowrap;
            min-width: 60px;
        }        .shalwar-value {
            border-bottom: none;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            min-height: 16px;
            padding: 1px 2px;
            font-weight: bold;
            color: #000;
        }

        /* Regular measurements grid for Shalwar */
        .measurements-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .measurements-grid .measure-item:nth-child(even) {
            margin-left: auto;
            margin-right: 0;
            width: 80mm;
        }

        .measurements-grid .measure-item:nth-child(odd) {
            width: 80mm;
            margin-right: auto;
        }

        .measure-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .measure-label {
            margin-right: 10px;
        }        .measure-value {
            border-bottom: none;
            min-width: 60px;
            width: fit-content;
            max-width: 100px;
            text-align: center;
            color: #000;
        }

        /* Separator line */
        .separator {
            height: 1px;
            background-color: #000;
            margin: 15px 0;
        }

        /* Extra demand section */
        .extra-demand {
            margin-top: 15px;
        }

        .extra-demand-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .extra-demand-value {
            border-bottom: 1px solid #999;
            padding: 5px 0;
            min-height: 20px;
            width: fit-content;
            max-width: 300px;
            min-width: 100px;
        }

        /* Hide empty fields in print */
        .print-field.empty {
            display: none !important;
        }

        .hidden {
            display: none !important;
        }

        /* No print styles for standalone print form */
        .no-print {
            display: none !important;
        }

        /* Print button styling */
        .print-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .print-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .print-btn:hover {
            background: #0056b3;
        }

        /* Auto print when page loads */
        @media print {
            body {
                margin: 0;
                padding: 0;
            }

            .print-controls {
                display: none !important;
            }

            /* Hide measurement fields marked as empty or "NO" during print */
            .print-hide-empty {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <!-- Print Controls -->
    <div class="print-controls no-print">
        <button class="print-btn" onclick="window.print()">🖨️ Print</button>
    </div> <!-- Print Form Layout -->
    <div class="print-form">
        <!-- Print Header with Logos -->
        <div class="print-header">
            <img src="../assets/img/logo-pic.png" alt="Noor & Sons Logo" class="logo-left">
            <div class="shop-info">
                <h2>Noor & Sons Tailors And Fabrics</h2>
                <p>We offer you stitching of your choice</p>
            </div>
            <div class="logo-right-container">
                <img src="../assets/img/coat_logo-pic.png" alt="Coat Logo" class="logo-right">
                <img src="../assets/img/Needle-logo.jpg" alt="Needle Logo" class="logo-right-bottom">
            </div>
        </div>

        <!-- Customer Info Section -->
        <div class="customer-info">
            <div class="info-row">
                <div class="info-item">
                    <label class="info-label">Code Number</label>
                    <div class="info-value" id="print-code-number"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Order Date</label>
                    <div class="info-value" id="print-order-date"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Return Date</label>
                    <div class="info-value" id="print-return-date"></div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-item">
                    <label class="info-label">Name</label>
                    <div class="info-value" id="print-name"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Age</label>
                    <div class="info-value" id="print-age"></div>
                </div>
                <div class="info-item">
                    <label class="info-label">Cell Number</label>
                    <div class="info-value" id="print-cell-number"></div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-item grid-span-3">
                    <label class="info-label">Address</label>
                    <div class="info-value" id="print-address"></div>
                </div>
            </div>
        </div> <!-- Cutting Section -->
        <div class="cutting-section">
            <div class="cutting-item">
                <label>Cutting No:</label>
                <div class="cutting-value" id="print-cutting-no"></div>
            </div>
            <div class="cutting-item">
                <label>Quantity:</label>
                <div class="cutting-value" id="print-quantity"></div>
            </div>
            <div class="cutting-item">
                <label>Enter by <span id="print-entered-by">Abubakkar</span></label>
            </div>
            <div class="garment-type">شلوار قمیص</div>
        </div> <!-- Qameez Section -->
        <div class="measurement-section" id="print-qameez-section">
            <div class="section-title">قمیص</div>
            <div class="qameez-two-column-grid">
                <!-- Column 1 -->
                <div class="qameez-column-1">
                    <div class="qameez-measure-item">
                        <span class="qameez-label">لمبائی</span>
                        <span class="qameez-value" id="qameez-lambai"></span>
                        <span class="qameez-style" id="qameez-daman-style"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">آستین</span>
                        <span class="qameez-value" id="qameez-asteen"></span>
                        <span class="qameez-style" id="qameez-sleeve-style"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">تیرا</span>
                        <span class="qameez-value" id="qameez-tera"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">بین / کالر</span>
                        <span class="qameez-collar-combined" id="qameez-collar-combined"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">چھاتی</span>
                        <span class="qameez-value" id="qameez-chati"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">کمر</span>
                        <span class="qameez-value" id="qameez-kamar"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">گیرہ</span>
                        <span class="qameez-value" id="qameez-gira"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">موڑہ</span>
                        <span class="qameez-value" id="qameez-moza"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">شولڈر</span>
                        <span class="qameez-value" id="qameez-shoulder"></span>
                    </div>
                </div> <!-- Column 2 -->
                <div class="qameez-column-2">
                    <div class="qameez-measure-item">
                        <span class="qameez-label">پاکٹ</span>
                        <span class="qameez-value" id="qameez-pocket-type"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">فرنٹ پاکٹ</span>
                        <span class="qameez-style" id="qameez-front-pocket-style"></span>
                        <span class="qameez-value" id="qameez-front-pocket-size"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label" id="qameez-cuff-plate-label">پلیٹ والا کف</span>
                        <span class="qameez-style" id="qameez-cuff-style"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">کف کاج</span>
                        <span class="qameez-value" id="qameez-cuff-kaj"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">چک پٹی</span>
                        <span class="qameez-value" id="qameez-chak-patti"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">چک پٹی کاج</span>
                        <span class="qameez-value" id="qameez-chak-patti-kaj"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">پٹی</span>
                        <span class="qameez-value" id="qameez-patti"></span>
                    </div>
                    <div class="qameez-measure-item">
                        <span class="qameez-label">پٹی چوڑائی</span>
                        <span class="qameez-value" id="qameez-patti-churai"></span>
                    </div>
                </div>
            </div>

            <!-- Grouped Options Section -->
            <div class="qameez-grouped-options">
                <div class="grouped-option-item">
                    <span class="option-label">عام رنگ بٹن</span>
                    <span class="option-value" id="qameez-button-color-grouped"></span>
                </div>
                <div class="grouped-option-item">
                    <span class="option-label">بٹن</span>
                    <span class="option-value" id="qameez-button-size-grouped"></span>
                </div>
                <div class="grouped-option-item">
                    <span class="option-label">سادہ سلائی</span>
                    <span class="option-value" id="qameez-silai-grouped"></span>
                </div>
            </div>
        </div>

        <!-- Separator Line -->
        <div class="separator"></div> <!-- Shalwar Section -->
        <div class="measurement-section" id="print-shalwar-section">
            <div class="shalwar-two-column-grid">
                <!-- Column 1 -->
                <div class="shalwar-column-1">
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">شلوار لمبائی</span>
                        <span class="shalwar-value" id="shalwar-lambai"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">پانچہ</span>
                        <span class="shalwar-value" id="shalwar-pacha"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">ہپ</span>
                        <span class="shalwar-value" id="shalwar-hip"></span>
                    </div>
                </div>

                <!-- Column 2 -->
                <div class="shalwar-column-2">
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">انسایڈ</span>
                        <span class="shalwar-value" id="shalwar-ander"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">شلوار پاکٹ</span>
                        <span class="shalwar-value" id="shalwar-pocket"></span>
                    </div>
                    <div class="shalwar-measure-item">
                        <span class="shalwar-label">شلوار قسم</span>
                        <span class="shalwar-value" id="shalwar-type"></span>
                    </div>
                </div>
            </div>
        </div><!-- Extra Demand Section -->
        <div class="extra-demand" id="print-extra-demand-section">
            <div class="extra-demand-label">ایکسٹرا ڈیمانڈ</div>
            <div class="extra-demand-value" id="print-extra-demand"></div>
        </div>
    </div>

    <!-- Print Controls (hidden during printing) -->
    <div class="print-controls" id="print-controls">
        <button onclick="manualPrint()" class="btn-print">🖨️ Print Again</button>
        <button onclick="window.close()" class="btn-close">✖ Close</button>
    </div>
    <script>
        // Print form functionality with comprehensive error handling
        function loadCustomerDataFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const customerId = urlParams.get('id');

                if (customerId) {
                    const customers = JSON.parse(localStorage.getItem('customers') || '[]');
                    const customer = customers.find(c => (c.id || c._id) === customerId);

                    if (customer) {
                        populatePrintForm(customer);
                        // Auto print after a delay to ensure everything loads
                        setTimeout(() => {
                            window.print();
                        }, 1000);
                    } else {
                        console.error('Customer not found with ID:', customerId);
                        alert('Customer data not found. Please check the customer ID.');
                    }
                } else {
                    console.error('No customer ID provided in URL');
                    alert('No customer ID provided in URL.');
                }
            } catch (error) {
                console.error('Error loading customer data:', error);
                alert('Error loading customer data: ' + error.message);
            }
        }

        function populatePrintForm(customer) {
            try {
                // Helper function to format date
                const formatPrintDate = (dateStr) => {
                    if (!dateStr) return '';
                    try {
                        const date = new Date(dateStr);
                        return date.toLocaleDateString();
                    } catch (e) {
                        return dateStr;
                    }
                };

                // Helper function to check if a field has a value
                const hasValue = (value) => {
                    return value && value.toString().trim() !== '';
                };

                // Helper function to safely set text content
                const safeSetTextContent = (id, value) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value || '';
                    } else {
                        console.warn(`Element with ID '${id}' not found in print form`);
                    }
                };

                // Populate customer info with error handling
                safeSetTextContent('print-code-number', customer.codeNumber);
                safeSetTextContent('print-order-date', formatPrintDate(customer.orderDate));
                safeSetTextContent('print-return-date', formatPrintDate(customer.returnDate));
                safeSetTextContent('print-name', customer.name);
                safeSetTextContent('print-age', customer.age);
                safeSetTextContent('print-cell-number', customer.cellNumber);
                safeSetTextContent('print-address', customer.address);
                safeSetTextContent('print-cutting-no', customer.cuttingNo);
                safeSetTextContent('print-quantity', customer.quantity);
                safeSetTextContent('print-entered-by', customer.enteredBy || 'Abubakkar');

                // Define measurements including collar_measurement
                const qameezMeasurements = [
                    { field: 'lambai', label: 'لمبائی' },
                    { field: 'asteen', label: 'آستین' },
                    { field: 'tera', label: 'تیرا' },
                    { field: 'collar_measurement', label: 'بین / کالر ماپ' },
                    { field: 'chati', label: 'چھاتی' },
                    { field: 'kamar', label: 'کمر' },
                    { field: 'gira', label: 'گیرہ' },
                    { field: 'moza', label: 'موڑہ' },
                    { field: 'gol_asteen', label: 'گول آستین' },
                    { field: 'collar_type', label: 'کالر ٹائپ' },
                    { field: 'collar_style', label: 'کالر اسٹائل' },
                    { field: 'front_pocket_size', label: 'فرنٹ پاکٹ سائز' },
                    { field: 'double_side_pocket', label: 'ڈبل سائیڈ پاکٹ' },
                    { field: 'single_pocket', label: 'سنگل پاکٹ' },
                    { field: 'front_pocket', label: 'فرنٹ پاکٹ' },
                    { field: 'silai', label: 'سلائی' },
                    { field: 'button_color', label: 'بٹن کا رنگ' },
                    { field: 'button', label: 'بٹن' },
                    { field: 'button_size', label: 'بٹن سائز' },
                    { field: 'cuff_plate', label: 'کف پلیٹ' },
                    { field: 'cuff_style', label: 'کف اسٹائل' },
                    { field: 'cuff_kaj', label: 'کف کاج' }, { field: 'chak_patti', label: 'چک پٹی' },
                    { field: 'chak_patti_kaj', label: 'چک پٹی کاج' },
                    { field: 'daman', label: 'دامن' },
                    { field: 'shoulder', label: 'شولڈر' },
                    { field: 'shoulder_style', label: 'شولڈر اسٹائل' },
                    { field: 'sleeve_type', label: 'آستین کی قسم' },
                    { field: 'patti', label: 'پٹی' },
                    { field: 'patti_churai', label: 'پٹی چوڑائی' }
                ];

                const shalwarMeasurements = [{ field: 'shalwar_lambai', label: 'شلوار لمبائی' },
                { field: 'pacha', label: 'پانچہ' },
                { field: 'lib', label: 'ہپ' },
                { field: 'ander', label: 'انسایڈ' },
                { field: 'shalwar_pocket', label: 'شلوار پاکٹ' },
                { field: 'shalwar_type', label: 'شلوار قسم' }
                ];

                // Populate measurements
                const measurements = customer.measurements || {};                // Populate individual qameez fields in the two-column layout with error handling
                safeSetTextContent('qameez-lambai', measurements.lambai);
                safeSetTextContent('qameez-asteen', measurements.asteen);
                safeSetTextContent('qameez-tera', measurements.tera);

                // Populate combined collar field in the format: کالرانگلش 2 15 بین / کالر
                const collarParts = [];
                if (measurements.collar_type) collarParts.push(measurements.collar_type);
                if (measurements.collar_measurement) collarParts.push(measurements.collar_measurement);
                if (measurements.collar_ben_width_churai) collarParts.push(measurements.collar_ben_width_churai);
                if (collarParts.length > 0) collarParts.push('بین / کالر');
                safeSetTextContent('qameez-collar-combined', collarParts.join(' '));

                safeSetTextContent('qameez-chati', measurements.chati);
                safeSetTextContent('qameez-kamar', measurements.kamar);
                safeSetTextContent('qameez-gira', measurements.gira);
                safeSetTextContent('qameez-moza', measurements.moza);
                safeSetTextContent('qameez-shoulder', measurements.shoulder);

                // Populate style fields with error handling
                safeSetTextContent('qameez-daman-style', measurements.daman);
                safeSetTextContent('qameez-sleeve-style', measurements.sleeve_type);
                safeSetTextContent('qameez-collar-style', measurements.collar_style);
                safeSetTextContent('qameez-pocket-type', measurements.single_pocket || measurements.double_side_pocket);
                safeSetTextContent('qameez-front-pocket-style', measurements.front_pocket);
                safeSetTextContent('qameez-front-pocket-size', measurements.front_pocket_size);                safeSetTextContent('qameez-silai', measurements.silai);
                safeSetTextContent('qameez-button-color', measurements.button_color);
                safeSetTextContent('qameez-button-size', measurements.button_size);                // Combine button type and button size for qameez-button field
                let buttonCombined = '';
                if (measurements.button && measurements.button !== '') {
                    if (measurements.button_size && measurements.button_size !== '') {
                        buttonCombined = measurements.button_size + ' ' + measurements.button;
                    } else {
                        buttonCombined = measurements.button;
                    }
                } else if (measurements.button_size && measurements.button_size !== '') {
                    buttonCombined = measurements.button_size;                }
                safeSetTextContent('qameez-button', buttonCombined);
                
                // Combine cuff style and length with cuff plate prefix
                let cuffCombined = '';
                if (measurements.cuff_style) cuffCombined += measurements.cuff_style;
                if (measurements.cuff_length) cuffCombined += (cuffCombined ? ' ' : '') + measurements.cuff_length;
                
                // Add cuff plate prefix if available and not "NO"
                if (measurements.cuff_plate && measurements.cuff_plate !== 'NO' && measurements.cuff_plate !== '' && cuffCombined) {
                    cuffCombined = measurements.cuff_plate + ' ' + cuffCombined;
                }
                
                safeSetTextContent('qameez-cuff-style', cuffCombined); safeSetTextContent('qameez-cuff-kaj', measurements.cuff_kaj); safeSetTextContent('qameez-chak-patti', measurements.chak_patti);safeSetTextContent('qameez-chak-patti-kaj', measurements.chak_patti_kaj);
                
                // Handle gum_patti prefix for patti field
                let pattiValue = measurements.patti;
                if (measurements.gum_patti === 'Yes' && pattiValue && pattiValue !== 'پٹی') {
                    pattiValue = 'گم ' + pattiValue;
                }
                safeSetTextContent('qameez-patti', pattiValue);
                
                safeSetTextContent('qameez-patti-churai', measurements.patti_churai);                // Populate grouped options section
                safeSetTextContent('qameez-button-color-grouped', measurements.button_color);                // Combine button type and size for grouped section
                let buttonGroupedCombined = '';
                if (measurements.button && measurements.button !== '') {
                    if (measurements.button_size && measurements.button_size !== '') {
                        buttonGroupedCombined = measurements.button_size + ' ' + measurements.button;
                    } else {
                        buttonGroupedCombined = measurements.button;
                    }
                } else if (measurements.button_size && measurements.button_size !== '') {
                    buttonGroupedCombined = measurements.button_size;
                }
                safeSetTextContent('qameez-button-size-grouped', buttonGroupedCombined);
                
                safeSetTextContent('qameez-silai-grouped', measurements.silai);

                // Populate individual shalwar fields in the two-column layout with error handling
                safeSetTextContent('shalwar-lambai', measurements.shalwar_lambai);
                safeSetTextContent('shalwar-pacha', measurements.pacha);
                safeSetTextContent('shalwar-hip', measurements.lib);
                safeSetTextContent('shalwar-ander', measurements.ander);
                safeSetTextContent('shalwar-pocket', measurements.shalwar_pocket);
                safeSetTextContent('shalwar-type', measurements.shalwar_type);

                // Generate Qameez measurements HTML (for dynamic container if needed)
                // Note: We're now using static two-column layout, so this container might not exist
                const qameezContainer = document.getElementById('print-qameez-measurements');
                if (qameezContainer) {
                    qameezContainer.innerHTML = '';

                    qameezMeasurements.forEach(item => {
                        if (hasValue(measurements[item.field])) {
                            const measureItem = document.createElement('div');
                            measureItem.className = 'measure-item';
                            measureItem.innerHTML = `
                                <div class="measure-label">${item.label}</div>
                                <div class="measure-value">${measurements[item.field]}</div>
                            `;
                            qameezContainer.appendChild(measureItem);
                        }
                    });
                }

                // Hide sections if no measurements (with error handling)
                const qameezSection = document.getElementById('print-qameez-section');
                // Check if qameez has any data by looking at the main fields
                const hasQameezData = measurements.lambai || measurements.asteen || measurements.chati || measurements.collar_measurement;
                if (qameezSection) {
                    if (!hasQameezData && (!qameezContainer || qameezContainer.children.length === 0)) {
                        qameezSection.classList.add('hidden');
                    } else {
                        qameezSection.classList.remove('hidden');
                    }
                } const shalwarSection = document.getElementById('print-shalwar-section');
                // Check if shalwar has any data by looking at the main fields
                const hasShalwarData = measurements.shalwar_lambai || measurements.pacha || measurements.lib;
                if (shalwarSection) {
                    if (!hasShalwarData) {
                        shalwarSection.classList.add('hidden');
                    } else {
                        shalwarSection.classList.remove('hidden');
                    }
                }

                // Handle extra demand with error handling
                const extraDemandValue = measurements.extra_demand || '';
                safeSetTextContent('print-extra-demand', extraDemandValue);
                const extraDemandSection = document.getElementById('print-extra-demand-section');
                if (extraDemandSection) {
                    if (extraDemandValue) {
                        extraDemandSection.classList.remove('hidden');
                    } else {
                        extraDemandSection.classList.add('hidden');
                    }
                }

                // Hide measurement fields that are "NO" or empty for print
                hidePrintEmptyFields(measurements);

                // Adjust qameez container height to prevent separator overlap
                adjustQameezContainerHeight();
            } catch (error) {
                console.error('Error populating print form:', error);
                alert('Error loading print data: ' + error.message);
            }
        }        // Function to hide measurement fields that are "NO" or empty for print
        function hidePrintEmptyFields(measurements) {
            try {
                // Get all measurement items in qameez and shalwar sections
                const qameezItems = document.querySelectorAll('.qameez-measure-item');
                const shalwarItems = document.querySelectorAll('.shalwar-measure-item');
                const dynamicItems = document.querySelectorAll('.measure-item');
                const groupedItems = document.querySelectorAll('.grouped-option-item');
                // Process qameez measurement items
                qameezItems.forEach(item => {
                    const valueElement = item.querySelector('.qameez-value');
                    const styleElement = item.querySelector('.qameez-style');
                    const collarElement = item.querySelector('.qameez-collar-combined');

                    if (valueElement) {
                        const value = valueElement.textContent.trim();
                        const styleValue = styleElement ? styleElement.textContent.trim() : '';

                        // Hide if value is empty, "NO", or style is "NO"
                        if (!value || value.toLowerCase() === 'no' || styleValue.toLowerCase() === 'no') {
                            item.classList.add('print-hide-empty');
                        } else {
                            item.classList.remove('print-hide-empty');
                        }
                    } else if (collarElement) {
                        const value = collarElement.textContent.trim();

                        // Hide if collar combined value is empty, just "بین / کالر" or "NO"
                        if (!value || value === 'بین / کالر' || value.toLowerCase() === 'no') {
                            item.classList.add('print-hide-empty');
                        } else {
                            item.classList.remove('print-hide-empty');
                        }
                    }
                });

                // Process shalwar measurement items (static layout)
                shalwarItems.forEach(item => {
                    const valueElement = item.querySelector('.shalwar-value');

                    if (valueElement) {
                        const value = valueElement.textContent.trim();

                        // Hide if value is empty or "NO"
                        if (!value || value.toLowerCase() === 'no') {
                            item.classList.add('print-hide-empty');
                        } else {
                            item.classList.remove('print-hide-empty');
                        }
                    }
                });

                // Process dynamic measurement items (if any)
                dynamicItems.forEach(item => {
                    const valueElement = item.querySelector('.measure-value');

                    if (valueElement) {
                        const value = valueElement.textContent.trim();

                        // Hide if value is empty or "NO"
                        if (!value || value.toLowerCase() === 'no') {
                            item.classList.add('print-hide-empty');
                        } else {
                            item.classList.remove('print-hide-empty');
                        }
                    }
                });

                // Process grouped option items
                groupedItems.forEach(item => {
                    const valueElement = item.querySelector('.option-value');

                    if (valueElement) {
                        const value = valueElement.textContent.trim();

                        // Hide if value is empty or "NO"
                        if (!value || value.toLowerCase() === 'no') {
                            item.classList.add('print-hide-empty');
                        } else {
                            item.classList.remove('print-hide-empty');
                        }
                    }
                });

                console.log('Applied print hide rules to measurement fields');
                console.log('Qameez items processed:', qameezItems.length);
                console.log('Shalwar items processed:', shalwarItems.length);
                console.log('Dynamic items processed:', dynamicItems.length);
                console.log('Grouped items processed:', groupedItems.length);
            } catch (error) {
                console.error('Error hiding empty print fields:', error);
            }
        }

        // Function to adjust qameez container height to prevent separator overlap
        function adjustQameezContainerHeight() {
            try {
                const container = document.querySelector('.qameez-two-column-grid');
                const column1 = document.querySelector('.qameez-column-1');
                const column2 = document.querySelector('.qameez-column-2');

                if (container && column1 && column2) {
                    // Get the actual height of both columns
                    const column1Height = column1.offsetHeight;
                    const column2Height = column2.offsetHeight;

                    // Set container height to the taller column plus some padding
                    const maxHeight = Math.max(column1Height, column2Height);
                    container.style.minHeight = (maxHeight + 20) + 'px';

                    console.log('Adjusted qameez container height:', maxHeight + 20, 'px');
                    console.log('Column 1 height:', column1Height, 'px');
                    console.log('Column 2 height:', column2Height, 'px');
                }
            } catch (error) {
                console.error('Error adjusting qameez container height:', error);
            }
        }

        // Manual print function for backup
        function manualPrint() {
            try {
                window.print();
            } catch (error) {
                console.error('Print error:', error);
                alert('Print failed: ' + error.message);
            }
        }

        // Load customer data when page loads
        window.addEventListener('load', loadCustomerDataFromURL);
    </script>
</body>

</html>